<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário 2 - Lista de Presença</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF para gerar PDFs reais -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #f5f5f5;
            color: #333;
            padding: 20px;
            font-size: 12pt;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header-form {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #3182ce;
        }
        
        .header-form h1 {
            font-size: 16pt;
            color: #2c7a47;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .header-form h2 {
            font-size: 14pt;
            color: #444;
            margin-bottom: 5px;
        }
        
        .info-group {
            margin-bottom: 20px;
        }
        
        .info-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
            font-size: 11pt;
        }
        
        .info-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12pt;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .table-container {
            margin: 30px 0;
            overflow-x: auto;
        }
        
        .presenca-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .presenca-table th {
            background: #3182ce;
            color: white;
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
            font-weight: bold;
            font-size: 11pt;
        }
        
        .presenca-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .presenca-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .presenca-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11pt;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 12pt;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-secondary {
            background: #666;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #555;
        }
        
        .btn-primary {
            background: #3182ce;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2c5282;
        }
        
        .btn-success {
            background: #38a169;
            color: white;
        }
        
        .btn-success:hover {
            background: #2c7a47;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            background: #3182ce;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .grid-3 {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .presenca-table {
                font-size: 10pt;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabeçalho do Formulário -->
        <div class="header-form">
            <h1>ESCRITÓRIO REGIONAL DE CURITIBA</h1>
            <h2>SETOR DE LICENCIAMENTO DE ENERGIA</h2>
        </div>
        
        <!-- Informações do Evento -->
        <div class="grid-3">
            <div class="info-group">
                <label for="evento">EVENTO (VISTORIA/REUNIÃO):</label>
                <input type="text" id="evento" placeholder="Tipo do evento" required>
            </div>
            <div class="info-group">
                <label for="local">LOCAL:</label>
                <input type="text" id="local" placeholder="Local do evento" required>
            </div>
            <div class="info-group">
                <label for="datahora">DATA E HORA:</label>
                <input type="datetime-local" id="datahora" required>
            </div>
        </div>
        
        <!-- Tabela de Participantes -->
        <div class="table-container">
            <table class="presenca-table">
                <thead>
                    <tr>
                        <th width="25%">NOME</th>
                        <th width="25%">E-MAIL</th>
                        <th width="25%">EMPRESA</th>
                        <th width="25%">ASSINATURA</th>
                    </tr>
                </thead>
                <tbody id="participantesBody">
                    <!-- 15 linhas para participantes -->
                </tbody>
            </table>
        </div>
        
        <button onclick="adicionarParticipante()" style="margin-top: 10px; padding: 10px 20px; background: #4a5568; color: white; border: none; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-user-plus"></i> Adicionar Participante
        </button>
        
        <!-- Botões de Ação -->
        <div class="buttons">
            <button class="btn btn-secondary" onclick="window.location.href = 'index.html'">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
            <button class="btn btn-primary" onclick="salvarFormulario()">
                <i class="fas fa-save"></i> Salvar Rascunho
            </button>
            <button class="btn btn-success" onclick="gerarPDFReal()">
                <i class="fas fa-file-pdf"></i> Gerar PDF
            </button>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div class="toast" id="toast"></div>

    <script>
        // Dados do formulário
        let dadosFormulario = {
            evento: '',
            local: '',
            datahora: '',
            participantes: []
        };
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Data e hora atuais
            const agora = new Date();
            const dataHora = agora.toISOString().slice(0, 16);
            document.getElementById('datahora').value = dataHora;
            
            // Carregar dados salvos
            carregarDados();
            
            // Gerar tabela de participantes (15 linhas)
            gerarParticipantes();
        });
        
        // Gerar tabela de participantes (15 linhas)
        function gerarParticipantes() {
            const tbody = document.getElementById('participantesBody');
            let html = '';
            
            for (let i = 0; i < 15; i++) {
                html += `
                    <tr>
                        <td><input type="text" id="nome_${i}" placeholder="Nome completo" oninput="atualizarParticipante(${i}, 'nome', this.value)"></td>
                        <td><input type="email" id="email_${i}" placeholder="e-mail@exemplo.com" oninput="atualizarParticipante(${i}, 'email', this.value)"></td>
                        <td><input type="text" id="empresa_${i}" placeholder="Nome da empresa" oninput="atualizarParticipante(${i}, 'empresa', this.value)"></td>
                        <td>
                            <input type="text" id="assinatura_${i}" placeholder="Assinatura" 
                                   style="font-style: italic; color: #666;"
                                   oninput="atualizarParticipante(${i}, 'assinatura', this.value)">
                            <button type="button" onclick="capturarAssinatura(${i})" style="margin-top: 5px; padding: 5px 10px; background: #3182ce; color: white; border: none; border-radius: 3px; font-size: 10pt; cursor: pointer;">
                                <i class="fas fa-signature"></i> Assinar
                            </button>
                        </td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = html;
        }
        
        function adicionarParticipante() {
            const tbody = document.getElementById('participantesBody');
            const count = tbody.children.length;
            
            const novaLinha = document.createElement('tr');
            novaLinha.innerHTML = `
                <td><input type="text" id="nome_${count}" placeholder="Nome completo" oninput="atualizarParticipante(${count}, 'nome', this.value)"></td>
                <td><input type="email" id="email_${count}" placeholder="e-mail@exemplo.com" oninput="atualizarParticipante(${count}, 'email', this.value)"></td>
                <td><input type="text" id="empresa_${count}" placeholder="Nome da empresa" oninput="atualizarParticipante(${count}, 'empresa', this.value)"></td>
                <td>
                    <input type="text" id="assinatura_${count}" placeholder="Assinatura" 
                           style="font-style: italic; color: #666;"
                           oninput="atualizarParticipante(${count}, 'assinatura', this.value)">
                    <button type="button" onclick="capturarAssinatura(${count})" style="margin-top: 5px; padding: 5px 10px; background: #3182ce; color: white; border: none; border-radius: 3px; font-size: 10pt; cursor: pointer;">
                        <i class="fas fa-signature"></i> Assinar
                    </button>
                </td>
            `;
            
            tbody.appendChild(novaLinha);
        }
        
        function capturarAssinatura(index) {
            const nome = prompt("Digite seu nome para assinar:");
            if (nome) {
                document.getElementById(`assinatura_${index}`).value = nome;
                atualizarParticipante(index, 'assinatura', nome);
                mostrarToast(`Assinatura registrada: ${nome}`, 'success');
            }
        }
        
        function atualizarParticipante(index, campo, valor) {
            if (!dadosFormulario.participantes[index]) {
                dadosFormulario.participantes[index] = { nome: '', email: '', empresa: '', assinatura: '' };
            }
            dadosFormulario.participantes[index][campo] = valor;
        }
        
        // Salvar formulário
        function salvarFormulario() {
            dadosFormulario.evento = document.getElementById('evento').value;
            dadosFormulario.local = document.getElementById('local').value;
            dadosFormulario.datahora = document.getElementById('datahora').value;
            
            // Coletar participantes
            for (let i = 0; i < 30; i++) {
                const nomeInput = document.getElementById(`nome_${i}`);
                const emailInput = document.getElementById(`email_${i}`);
                const empresaInput = document.getElementById(`empresa_${i}`);
                const assinaturaInput = document.getElementById(`assinatura_${i}`);
                
                if (nomeInput || emailInput || empresaInput || assinaturaInput) {
                    if (!dadosFormulario.participantes[i]) {
                        dadosFormulario.participantes[i] = { nome: '', email: '', empresa: '', assinatura: '' };
                    }
                    
                    if (nomeInput) dadosFormulario.participantes[i].nome = nomeInput.value;
                    if (emailInput) dadosFormulario.participantes[i].email = emailInput.value;
                    if (empresaInput) dadosFormulario.participantes[i].empresa = empresaInput.value;
                    if (assinaturaInput) dadosFormulario.participantes[i].assinatura = assinaturaInput.value;
                }
            }
            
            // Salvar no localStorage
            localStorage.setItem('formulario2', JSON.stringify(dadosFormulario));
            
            mostrarToast('Lista de presença salva com sucesso!', 'success');
        }
        
        function carregarDados() {
            const dadosSalvos = localStorage.getItem('formulario2');
            if (dadosSalvos) {
                dadosFormulario = JSON.parse(dadosSalvos);
                
                // Preencher campos básicos
                document.getElementById('evento').value = dadosFormulario.evento || '';
                document.getElementById('local').value = dadosFormulario.local || '';
                document.getElementById('datahora').value = dadosFormulario.datahora || '';
                
                // Preencher participantes
                dadosFormulario.participantes.forEach((part, index) => {
                    const nomeInput = document.getElementById(`nome_${index}`);
                    const emailInput = document.getElementById(`email_${index}`);
                    const empresaInput = document.getElementById(`empresa_${index}`);
                    const assinaturaInput = document.getElementById(`assinatura_${index}`);
                    
                    if (nomeInput) nomeInput.value = part.nome || '';
                    if (emailInput) emailInput.value = part.email || '';
                    if (empresaInput) empresaInput.value = part.empresa || '';
                    if (assinaturaInput) assinaturaInput.value = part.assinatura || '';
                });
                
                mostrarToast('Dados anteriores carregados', 'info');
            }
        }
        
        // ============================================
        // FUNÇÃO PARA GERAR PDF REAL
        // ============================================
        function gerarPDFReal() {
            salvarFormulario();
            
            if (!dadosFormulario.evento || !dadosFormulario.local || !dadosFormulario.datahora) {
                mostrarToast('Preencha as informações do evento', 'error');
                return;
            }
            
            mostrarToast('Gerando PDF profissional...', 'info');
            
            // Usar jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configurações da página
            const pageWidth = doc.internal.pageSize.width;
            const pageHeight = doc.internal.pageSize.height;
            const marginLeft = 20;
            const marginRight = 20;
            const marginTop = 30;
            let yPos = marginTop;
            
            // ============================================
            // CABEÇALHO
            // ============================================
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text("ESCRITÓRIO REGIONAL DE CURITIBA", pageWidth / 2, yPos, { align: 'center' });
            yPos += 8;
            
            doc.setFontSize(14);
            doc.text("SETOR DE LICENCIAMENTO DE ENERGIA", pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;
            
            // ============================================
            // INFORMAÇÕES DO EVENTO
            // ============================================
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text("EVENTO:", marginLeft, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(dadosFormulario.evento, marginLeft + 25, yPos);
            yPos += 7;
            
            doc.setFont('helvetica', 'bold');
            doc.text("LOCAL:", marginLeft, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(dadosFormulario.local, marginLeft + 22, yPos);
            yPos += 7;
            
            const dataFormatada = new Date(dadosFormulario.datahora).toLocaleString('pt-BR');
            doc.setFont('helvetica', 'bold');
            doc.text("DATA E HORA:", marginLeft, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(dataFormatada, marginLeft + 40, yPos);
            yPos += 15;
            
            // Linha separadora
            doc.setLineWidth(0.5);
            doc.line(marginLeft, yPos, pageWidth - marginRight, yPos);
            yPos += 10;
            
            // ============================================
            // LISTA DE PRESENÇA
            // ============================================
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text("LISTA DE PRESENÇA", pageWidth / 2, yPos, { align: 'center' });
            yPos += 10;
            
            // Cabeçalho da tabela
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text("Nº", marginLeft, yPos);
            doc.text("NOME", marginLeft + 15, yPos);
            doc.text("E-MAIL", marginLeft + 80, yPos);
            doc.text("EMPRESA", marginLeft + 140, yPos);
            doc.text("ASSINATURA", pageWidth - marginRight - 30, yPos, { align: 'right' });
            yPos += 5;
            
            // Linha da tabela
            doc.setLineWidth(0.2);
            doc.line(marginLeft, yPos, pageWidth - marginRight, yPos);
            yPos += 5;
            
            // Participantes
            doc.setFont('helvetica', 'normal');
            let numeroParticipante = 1;
            
            dadosFormulario.participantes.forEach(part => {
                if (part.nome || part.email || part.empresa) {
                    // Verificar se precisa de nova página
                    if (yPos > pageHeight - 20) {
                        doc.addPage();
                        yPos = marginTop;
                        
                        // Cabeçalho da tabela na nova página
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'bold');
                        doc.text("Nº", marginLeft, yPos);
                        doc.text("NOME", marginLeft + 15, yPos);
                        doc.text("E-MAIL", marginLeft + 80, yPos);
                        doc.text("EMPRESA", marginLeft + 140, yPos);
                        doc.text("ASSINATURA", pageWidth - marginRight - 30, yPos, { align: 'right' });
                        yPos += 5;
                        doc.line(marginLeft, yPos, pageWidth - marginRight, yPos);
                        yPos += 5;
                    }
                    
                    // Número
                    doc.text(numeroParticipante.toString(), marginLeft, yPos);
                    
                    // Nome (com quebra de linha se necessário)
                    const nomeLinhas = doc.splitTextToSize(part.nome || '', 60);
                    nomeLinhas.forEach((linha, idx) => {
                        doc.text(linha, marginLeft + 15, yPos + (idx * 5));
                    });
                    
                    // Email
                    const emailLinhas = doc.splitTextToSize(part.email || '', 55);
                    emailLinhas.forEach((linha, idx) => {
                        doc.text(linha, marginLeft + 80, yPos + (idx * 5));
                    });
                    
                    // Empresa
                    const empresaLinhas = doc.splitTextToSize(part.empresa || '', 40);
                    empresaLinhas.forEach((linha, idx) => {
                        doc.text(linha, marginLeft + 140, yPos + (idx * 5));
                    });
                    
                    // Assinatura
                    doc.text(part.assinatura || '', pageWidth - marginRight - 30, yPos, { align: 'right' });
                    
                    // Ajustar altura para a próxima linha
                    const maxLinhas = Math.max(
                        nomeLinhas.length,
                        emailLinhas.length,
                        empresaLinhas.length,
                        1
                    );
                    
                    yPos += (maxLinhas * 5) + 5;
                    numeroParticipante++;
                    
                    // Linha separadora entre participantes
                    doc.line(marginLeft, yPos - 2, pageWidth - marginRight, yPos - 2);
                }
            });
            
            // ============================================
            // RODAPÉ
            // ============================================
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                
                // Número da página
                doc.setFontSize(8);
                doc.text(`Página ${i} de ${totalPages}`, pageWidth / 2, pageHeight - 10, { align: 'center' });
                
                // Data de geração
                const dataGeracao = new Date().toLocaleDateString('pt-BR');
                doc.text(`Gerado em: ${dataGeracao}`, pageWidth - marginRight, pageHeight - 10, { align: 'right' });
                
                // Logo IAT
                doc.setFontSize(6);
                doc.text("IAT - Instituto Água e Terra - Paraná", marginLeft, pageHeight - 10);
            }
            
            // ============================================
            // SALVAR PDF
            // ============================================
            const nomeArquivo = `Lista_Presenca_${dadosFormulario.evento.replace(/\s+/g, '_')}_${new Date(dadosFormulario.datahora).toISOString().slice(0,10)}.pdf`;
            doc.save(nomeArquivo);
            
            mostrarToast(`PDF "${nomeArquivo}" gerado com sucesso!`, 'success');
        }
        
        // Toast messages
        function mostrarToast(mensagem, tipo = 'success') {
            const toast = document.getElementById('toast');
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                info: 'info-circle'
            };
            
            toast.innerHTML = `<i class="fas fa-${icons[tipo]}"></i> ${mensagem}`;
            toast.style.background = {
                success: '#38a169',
                error: '#e53e3e',
                info: '#3182ce'
            }[tipo];
            
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
